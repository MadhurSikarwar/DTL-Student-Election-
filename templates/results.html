<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Results â€” E-Vote 2025</title>

    <title>Live Results â€” RVCE E-Vote</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/variables.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/results.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/hamburger.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>

<body>

    <!-- ================= NAVBAR ================= -->
    <nav class="navbar" role="navigation" aria-label="Main Navigation">
        <a href="{{ url_for('home') }}" class="logo" style="text-decoration: none;" aria-label="E-Vote Home">RVCE
            E-Vote</a>

        <!-- HAMBURGER ICON -->
        <div class="hamburger" onclick="toggleMenu()">
            <div class="line1"></div>
            <div class="line2"></div>
            <div class="line3"></div>
        </div>

        <!-- DESKTOP NAV -->
        <div class="nav-links">
            <a href="{{ url_for('dashboard') }}" class="nav-item">Home</a>
            <a href="{{ url_for('vote') }}" class="nav-item">Vote</a>
            <a href="{{ url_for('results') }}" class="nav-item active">Results</a>
            <a href="{{ url_for('architecture') }}" class="nav-item">System Info</a>

            <div class="nav-actions">
                <span class="user-pill" aria-label="Logged in as student">{{ session['student_id'] }}</span>
                <button id="themeToggleBtn" class="nav-btn theme-btn" onclick="toggleTheme()"
                    aria-label="Toggle Dark/Light Mode">
                    <span class="theme-icon">ðŸŒ™</span>
                </button>
                <a href="{{ url_for('logout') }}" class="nav-btn logout-btn" aria-label="Logout">Logout</a>
            </div>
        </div>

        <!-- MOBILE MENU DRAWER -->
        <div class="mobile-menu" id="mobileMenu">


            <a href="{{ url_for('dashboard') }}" class="mobile-nav-link">Home</a>
            <a href="{{ url_for('vote') }}" class="mobile-nav-link">Vote</a>
            <a href="{{ url_for('results') }}" class="mobile-nav-link">Results</a>
            <a href="{{ url_for('architecture') }}" class="mobile-nav-link">System Info</a>

            <div class="mobile-actions">
                <span class="user-pill">{{ session['student_id'] }}</span>
                <a href="{{ url_for('logout') }}" class="nav-btn logout-btn" style="text-align: center;">Logout</a>
            </div>
        </div>
    </nav>

    <!-- ================= MAIN ================= -->
    <div class="main-wrapper">
        <div class="container">

            <!-- CSV Download (Moved from Navbar) -->
            <div style="display: flex; justify-content: flex-end; margin-bottom: 1rem;">
                <button onclick="downloadCSV()" class="nav-btn"
                    style="background: rgba(16, 185, 129, 0.2); color: #10b981; border: 1px solid #10b981; padding: 0.5rem 1rem; cursor: pointer;">
                    ðŸ“¥ Download Report
                </button>
            </div>

            <!-- ===== WINNER BOX ===== -->
            <div id="winnerBox" class="winner-box">
                <div class="winner-content">
                    <div class="crown-icon">ðŸ‘‘</div>
                    <h2 id="winnerText">Winner: Calculating...</h2>
                    <p class="note">
                        <span class="live-dot"></span> Live updates from Blockchain
                    </p>
                </div>
                <div class="overlay"></div>
            </div>

            <!-- ===== CHART SECTION ===== -->
            <div class="chart-container"
                style="margin-bottom: 2rem; background: var(--bg-surface); padding: 1.5rem; border-radius: 16px; border: 1px solid var(--border-color);">
                <canvas id="voteChart" height="100"></canvas>
            </div>

            <!-- ================= RESULTS GRID ================= -->
            <div class="results-grid">
                {% for cand in candidates %}
                <div class="result-card" id="card{{ cand.id }}" data-id="{{ cand.id }}">
                    <div class="rank-badge">#{{ loop.index }}</div>
                    <div class="img-wrapper">
                        <img src="{{ url_for('static', filename='images/' + cand.image) }}" class="cand-img"
                            onerror="this.src='https://via.placeholder.com/150'">
                    </div>
                    <div class="info">
                        <h3>{{ cand.name }}</h3>
                        <p class="position">{{ cand.position }}</p>
                    </div>
                    <div class="vote-count">
                        <span id="v{{ cand.id }}" class="count">0</span>
                        <span class="label">Votes</span>
                    </div>
                    <div class="progress-bar">
                        <div class="fill"></div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- ================= SCRIPTS ================= -->
    <!-- Chart.js via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='vendor/ethers.umd.min.js') }}"></script>

    <!-- Pass Python Candidates to JS -->
    <!-- Pass Python Candidates to JS -->
    <script id="candidates-data" type="application/json">
        {{ candidates | tojson | safe }}
    </script>
    <script>
        window.ALL_CANDIDATES = JSON.parse(document.getElementById('candidates-data').textContent);
        // ðŸ’‰ INJECTED FROM BACKEND
        window.CONTRACT_ADDRESS = "{{ CONTRACT_ADDRESS }}"; 
    </script>

    <script src="{{ url_for('static', filename='jss/blockchainConfig.js') }}"></script>
    <script src="{{ url_for('static', filename='jss/results.js') }}"></script>
    <script src="{{ url_for('static', filename='jss/theme.js') }}"></script>
    <script src="{{ url_for('static', filename='jss/cursor.js') }}"></script>
    <script src="{{ url_for('static', filename='jss/background-particles.js') }}"></script>
    <script src="{{ url_for('static', filename='jss/hamburger.js') }}"></script>

    <!-- ================= WINNER BACKGROUND SCRIPT ================= -->


</body>

</html>