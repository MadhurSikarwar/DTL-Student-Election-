<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard ‚Äî RVCE E-Vote</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/variables.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <!-- Optional for icons -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_dashboard.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/hamburger.css') }}">
</head>

<body>

    <!-- NAVBAR -->
    <nav class="admin-nav">
        <div class="admin-brand">
            RVCE E-VOTE <span class="badge">ADMIN</span>
        </div>

        <!-- HAMBURGER ICON -->
        <div class="hamburger" onclick="toggleMenu()">
            <div class="line1"></div>
            <div class="line2"></div>
            <div class="line3"></div>
        </div>

        <!-- DESKTOP NAV -->
        <div class="admin-user">
            <div class="user-pill">
                üë§ {{ admin_email }}
            </div>
            <button id="themeToggleBtn" class="theme-btn" onclick="toggleTheme()" aria-label="Toggle Dark/Light Mode"
                style="margin-right: 1rem;">
                <span class="theme-icon">üåô</span>
            </button>
            <a href="/admin/logout" class="logout-btn">Log Out</a>
        </div>

        <!-- MOBILE MENU DRAWER -->
        <div class="mobile-menu" id="mobileMenu">


            <!-- No navigational links for Admin, just actions -->
            <div class="mobile-actions" style="margin-top: 1rem;">
                <span class="user-pill" style="display: block; text-align: center;">üë§ {{ admin_email }}</span>

                <button onclick="toggleTheme()" class="nav-btn theme-btn"
                    style="width: 100%; justify-content: center; margin-top: 1rem; background: var(--bg-surface-hover);">
                    Toggle Theme üåô
                </button>

                <a href="/admin/logout" class="logout-btn"
                    style="text-align: center; display: block; margin-top: 1rem;">Log Out</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="grid-header">
            <h2>Dashboard Overview</h2>
            <div class="status-indicator">
                <div class="dot"></div> System Active
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- Election Name/ID -->
            <div class="card">
                <h3>Current Election ID</h3>
                <div class="value">#{{ current_election_id if current_election_id else '1' }}</div>
                <p style="color: var(--text-muted); font-size: 0.85rem;">Standard Cycle</p>
            </div>

            <!-- Total Votes -->
            <div class="card">
                <h3>Total Votes Cast</h3>
                <div class="value">{{ total_votes }}</div>
                <p style="color: var(--text-muted); font-size: 0.85rem;">Valid Blockchain Transactions</p>
            </div>
        </div>

        <!-- MANAGED CANDIDATES ZONE -->
        <div class="action-area area-primary">
            <div class="grid-header" style="margin-bottom: 1rem;">
                <h3 class="section-header-primary">üìã Manage Candidates</h3>
            </div>

            <!-- Add Candidate Form -->
            <form id="addCandidateForm" class="add-candidate-form">
                <div class="col-span-full">
                    <h4 class="form-title">Add New Candidate</h4>
                </div>

                <input type="text" name="name" placeholder="Candidate Name" required class="admin-input">

                <input type="text" name="position" placeholder="Position (e.g. Class Rep)" required class="admin-input">

                <div class="col-span-full"
                    style="display: flex; gap: 1rem; align-items: center; margin-bottom: 0.5rem;">
                    <span class="label-muted">Manifesto Type:</span>
                    <label
                        style="color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 5px;">
                        <input type="radio" name="manifestoType" value="text" checked
                            onclick="toggleManifestoInput('text')"> Write Text
                    </label>
                    <label
                        style="color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 5px;">
                        <input type="radio" name="manifestoType" value="file" onclick="toggleManifestoInput('file')">
                        Upload Document
                    </label>
                </div>

                <div id="manifestoTextInput" class="col-span-full">
                    <textarea name="manifesto" id="manifestoText" placeholder="Write Candidate Manifesto / Slogan..."
                        required class="admin-input" style="min-height: 80px; font-family: inherit;"></textarea>
                </div>

                <div id="manifestoFileInput" class="photo-upload-group col-span-full" style="display: none;">
                    <label class="label-muted">üìÑ Document (PDF/DOC):</label>
                    <input type="file" name="manifesto_file" id="manifestoFile" accept=".pdf,.doc,.docx,.txt"
                        class="label-muted">
                </div>

                <div class="photo-upload-group">
                    <label class="label-muted">Photo:</label>
                    <input type="file" name="image" accept="image/*" class="label-muted">
                    <button type="submit" class="btn-add">
                        + Add Candidate
                    </button>
                </div>
            </form>

            <!-- Candidate List -->
            <div class="table-container">
                <table class="admin-table">
                    <thead>
                        <tr class="thead-bg">
                            <th class="th-pad">ID</th>
                            <th class="th-pad">Photo</th>
                            <th class="th-pad">Name</th>
                            <th class="th-pad">Position</th>
                            <th class="th-right">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for cand in candidates %}
                        <tr class="row-border">
                            <td class="td-muted">#{{ cand.id }}</td>
                            <td class="td-pad">
                                <img src="{{ url_for('static', filename='images/' + cand.image) }}" alt="img"
                                    class="cand-thumb">
                            </td>
                            <td class="td-bold">{{ cand.name }}</td>
                            <td class="td-blue">{{ cand.position }}</td>
                            <td class="td-right">
                                <button onclick="deleteCandidate('{{ cand.id }}')" class="btn-delete">
                                    Delete
                                </button>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="5" class="no-cand-msg">No active candidates found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ELECTION CONTROL ZONE -->
        <div class="action-area area-blue">
            <div class="grid-header" style="margin-bottom: 1rem;">
                <h3 class="section-header-blue">‚ö° Election Control</h3>
            </div>

            <div class="control-grid">
                <!-- Pause/Resume Section -->
                <div class="control-panel">
                    <h4 class="form-title">Pause/Resume Voting</h4>
                    <p class="control-desc">Instantly freeze or unfreeze voting</p>

                    <div id="pauseStatusDisplay" class="status-box-active">
                        ‚ñ∂Ô∏è Voting is ACTIVE
                    </div>

                    <div class="control-btn-group">
                        <button id="pauseBtn" onclick="pauseElection()" class="btn-pause">
                            ‚è∏Ô∏è Pause
                        </button>
                        <button id="resumeBtn" onclick="resumeElection()" class="btn-resume">
                            ‚ñ∂Ô∏è Resume
                        </button>
                    </div>
                </div>

                <!-- Deadline Section -->
                <div class="control-panel">
                    <h4 class="form-title">Set Election Deadline</h4>
                    <p class="control-desc">Voting will automatically stop at this time</p>

                    <div id="deadlineDisplay" class="deadline-display">
                        No deadline set
                    </div>

                    <input type="datetime-local" id="deadlineInput" class="input-deadline">

                    <button onclick="setDeadline()" class="btn-set-deadline">
                        ‚è∞ Set Deadline
                    </button>
                </div>
            </div>
        </div>

        <!-- ACTION ZONE -->
        <div class="action-area">
            <div class="reset-zone">
                <div>
                    <h3 class="text-highlight">End Current Election & Start New</h3>
                    <p class="reset-desc">This will archive current votes and reset the voting status for all students.
                    </p>
                </div>

                <button id="newElectionBtn" class="btn-reset" onclick="confirmNewElection()">
                    <span>‚ö†Ô∏è Start New Election</span>
                </button>
            </div>
        </div>

        <!-- VOTER LOG -->
        <div class="voter-log">
            <h3>Recent Activity Log</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr class="thead-subtle">
                            <th>Student ID</th>
                            <th>Status</th>
                            <th>Timestamp</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if voters %}
                        {% for student in voters[-10:]|reverse %}
                        <tr>
                            <td class="td-mono-blue">{{ student }}</td>
                            <td><span class="status-voted">‚úî Voted</span></td>
                            <td class="label-muted">Just now</td>
                        </tr>
                        {% endfor %}
                        {% else %}
                        <tr>
                            <td colspan="3" class="no-votes-msg">No votes recorded yet.</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <script src="{{ url_for('static', filename='jss/admin_dashboard.js') }}"></script>
    <script src="{{ url_for('static', filename='jss/hamburger.js') }}"></script>
    <script src="{{ url_for('static', filename='jss/theme.js') }}"></script>
    <script src="{{ url_for('static', filename='jss/background-particles.js') }}"></script>
</body>

</html>