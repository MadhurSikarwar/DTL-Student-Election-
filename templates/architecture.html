<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Architecture ‚Äî RVCE E-Vote</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/variables.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/hamburger.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/architecture.css') }}">
</head>

<body>

    <nav class="navbar" role="navigation" aria-label="Main Navigation">
        <a href="{{ url_for('home') }}" class="logo" style="text-decoration: none;" aria-label="E-Vote Home">RVCE
            E-Vote</a>

        <!-- HAMBURGER ICON -->
        <div class="hamburger" onclick="toggleMenu()">
            <div class="line1"></div>
            <div class="line2"></div>
            <div class="line3"></div>
        </div>

        <!-- DESKTOP NAV -->
        <div class="nav-links">
            <a href="{{ url_for('dashboard') }}" class="nav-item">Home</a>
            <a href="{{ url_for('vote') }}" class="nav-item">Vote</a>
            <a href="{{ url_for('results') }}" class="nav-item">Results</a>
            <a href="{{ url_for('architecture') }}" class="nav-item active" aria-current="page">System Info</a>

            <div class="nav-actions">
                <span class="user-pill" aria-label="Logged in as student">{{ session['student_id'] }}</span>
                <button id="themeToggleBtn" class="nav-btn theme-btn" onclick="toggleTheme()"
                    aria-label="Toggle Dark/Light Mode">
                    <span class="theme-icon">üåô</span>
                </button>
                <a href="{{ url_for('logout') }}" class="nav-btn logout-btn" aria-label="Logout">Logout</a>
            </div>
        </div>

        <!-- MOBILE MENU DRAWER -->
        <div class="mobile-menu" id="mobileMenu">


            <a href="{{ url_for('dashboard') }}" class="mobile-nav-link">Home</a>
            <a href="{{ url_for('vote') }}" class="mobile-nav-link">Vote</a>
            <a href="{{ url_for('results') }}" class="mobile-nav-link">Results</a>
            <a href="{{ url_for('architecture') }}" class="mobile-nav-link">System Info</a>

            <div class="mobile-actions">
                <span class="user-pill">{{ session['student_id'] }}</span>
                <a href="{{ url_for('logout') }}" class="nav-btn logout-btn" style="text-align: center;">Logout</a>
            </div>
        </div>
    </nav>

    <div class="canvas-container">
        <h1>System Architecture Flow</h1>
        <p class="subtitle">A complete end-to-end visualization of the secure voting process, spanning client-side
            interactions, server-side orchestration, and distributed ledger recording.</p>

        <div class="flowchart">

            <!-- Security Zones -->
            <div class="boundary-line" style="top: 140px;">
                <span class="boundary-label" style="top: -10px;">Client-Side Boundary</span>
            </div>
            <div class="boundary-line" style="top: 540px;">
                <span class="boundary-label" style="top: -10px;">Secure Service Layer</span>
            </div>

            <!-- SVG Layer -->
            <svg class="connections" width="100%" height="100%">
                <defs>
                    <marker id="arrow" markerWidth="10" markerHeight="10" refX="10" refY="5" orient="auto">
                        <path d="M0,0 L10,5 L0,10" fill="#64748b" />
                    </marker>
                </defs>

                <!-- 1. User -> Frontend -->
                <!-- Use curved lines that avoid overlapping the nodes -->
                <path d="M450 140 L450 180" class="path-line" />

                <!-- 2. Frontend -> Flask -->
                <path d="M450 310 L450 380" class="path-line" />
                <rect x="400" y="335" width="100" height="24" class="label-bg" />
                <text x="450" y="347" class="label-text">HTTP / JSON API</text>

                <!-- 3. Flask -> Firebase -->
                <path d="M450 480 C450 520, 190 520, 190 600" class="path-line" />
                <rect x="220" y="530" width="100" height="24" class="label-bg" />
                <text x="270" y="542" class="label-text">Verify Token</text>

                <!-- 4. Flask -> Blockchain -->
                <path d="M450 480 C450 520, 710 520, 710 600" class="path-line" />
                <rect x="580" y="530" width="100" height="24" class="label-bg" />
                <text x="630" y="542" class="label-text">Sign Transaction</text>

                <!-- Return Loops (Feedback) -->
                <path d="M210 590 C210 540, 430 540, 430 490" class="path-line return" />
                <path d="M690 590 C690 540, 470 540, 470 490" class="path-line return" />

            </svg>

            <!-- Node 1: User -->
            <div class="node" id="user">
                <div class="node-icon">üë§</div>
                <h4>Voter</h4>
                <span>Initiates Action</span>
            </div>

            <!-- Node 2: Frontend -->
            <div class="node" id="frontend">
                <div class="node-icon">üñ•Ô∏è</div>
                <h4>Frontend UI</h4>
                <span>HTML5 ‚Ä¢ CSS3 ‚Ä¢ JS<br>Input Validation</span>
            </div>

            <!-- Node 3: Backend -->
            <div class="node" id="backend">
                <div class="node-icon">‚öôÔ∏è</div>
                <h4>Flask API</h4>
                <span>Business Logic & orchestration</span>
            </div>

            <!-- Node 4: Auth -->
            <div class="node" id="firebase">
                <div class="node-icon">üîê</div>
                <h4>Firebase Auth</h4>
                <span>Identity Verification<br>Session Security</span>
            </div>

            <!-- Node 5: Blockchain -->
            <div class="node" id="blockchain">
                <div class="node-icon">‚õìÔ∏è</div>
                <h4>Sepolia Chain</h4>
                <span>Smart Contract<br>Immutable Ledger</span>
            </div>

        </div>

        <div class="explainer-grid">
            <div class="explainer-card">
                <h3>Security Layers</h3>
                <p>The system employs a multi-layered security approach. Client-side validation ensures data integrity
                    before it reaches the API. The API enforces strict authentication via Firebase before communicating
                    with the blockchain via a secured Admin Wallet.</p>
            </div>
            <div class="explainer-card">
                <h3>Data Immutability</h3>
                <p>Once a transaction is confirmed on the Sepolia Testnet, it becomes a permanent record. This ensures
                    that election results are transparent, verifiable, and tamper-proof.</p>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='jss/theme.js') }}"></script>
    <!-- Use UI Polish instead of Cursor -->
    <script src="{{ url_for('static', filename='jss/ui-polish.js') }}"></script>
    <script src="{{ url_for('static', filename='jss/background-particles.js') }}"></script>
    <script src="{{ url_for('static', filename='jss/hamburger.js') }}"></script>
    <script src="{{ url_for('static', filename='jss/architecture.js') }}"></script>
</body>

</html>